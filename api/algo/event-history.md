# Event History

## Introduction

The `v1/fx/algo/event-history` endpoint allows selection of multiple metrics (fields) such as spread paid and market impact at different time horizons (corresponding to each child order event available in the Tradefeedr database).

It allows you to query all trading events for a given `ParentOrderID`. 
It should be used when you require a detailed analysis and understanding of a specific `ParentOrderID` execution profile.

## API Specification
The API endpoint requires a JSON object representing query logic similar to SQL and containing the following fields:

- `select`  - which fields should be returned in the end result. For example `SpreadPnLPM`. The full list of possible values is given below
- `filter`  - how the underlying data should be filtered

**Note:** `ParentOrderID` is the only valid filter field for this endpoint

## Example 
**Note**: For display purposes we have limited the number of rows to 5 and and columns to 10.

### Event History for a ParentOrderID

```python
```
## tradefeedr library
from tradefeedr_public_content.v1.generic.tradefeedr_api import TradefeedrApi

## need pandas to translate JSON results from API
import pandas as pd

## create API object
tf_api_object = TradefeedrApi(demo=True)

## options
options = {
    "select": [
        "ParentChild",
        "ParentOrderID",
        "TradeID",
        "Symbol",
        "Side",
        "TradeCcy",
        "TradeQuantityUSD",
        "OrderQuantity",
        "Price",
        "OrderType",
        "ExecVenue",
        "Mid0",
        "Mid1s",
        "DecayPM1s",
        "SpreadPnLPM",
        "ArrivalTime",
        "TradeTime"
    ],
    "filter": [
        {"function": "eq", "var": "ParentOrderID", "par": "20180903-A00"}
    ]
}

# this is api end-point which returns parent order stats one algo run per row
endpoint = "v1/fx/algo/event-history"

## call the API
response = tf_api_object.query_api(endpoint, options)

## translate API result into pandas dataframe
data_frame = pd.DataFrame(response["result"])
# data_frame = data_frame.set_index("ParentChild")

## translate TradeTime and ArrivalTime to human readable time
data_frame["TradeTime"] = pd.to_datetime(data_frame["TradeTime"],  unit="ms" if str(data_frame["TradeTime"].dtype) == "int64" else None)
data_frame["ArrivalTime"] = pd.to_datetime(data_frame["ArrivalTime"],  unit="ms" if str(data_frame["ArrivalTime"].dtype) == "int64" else None)
data_frame = data_frame.sort_values(by="ArrivalTime", ascending=False)
data_frame
```
```
#### Results

![api_algo_event_history_ex1.png](assets/images/api_algo/event_history/api_algo_event_history_ex1.png)

#### Figures

```python
```
# import plotly libary
import plotly.express as px

# Modify dataframe
data_frame = data_frame.set_index("ArrivalTime")

# Plot figure 1
fig = px.line(data_frame[data_frame.ParentChild=="Child"][["TradeQuantityUSD"]],
             title="Child Fills TradeQuantityUSD")

fig.show()

# Plot figure 2
fig = px.line(data_frame[data_frame.ParentChild=="Child"][["Price", "Mid0"]],
             title="Price and Mid Price of Child Fills ")
fig.show()

# Plot figure 3
fig = px.line(data_frame[data_frame.ParentChild=="Child"][["SpreadPnLPM"]],
             title="Child Fills SpreadPnLPM")

fig.show()
```
```
## Field Definitions

Refer to [Analytics Algo](../analytics/algo.md) page for details and formula.

[%header,format=csv, cols=["60%", "40%"]]

```csv
Name,Description
ParentChild,"Equal to either ""Parent"" or ""Child""  and determines whether the rows is ""Parent"" or ""Child"" row. ""Parent” rows are the events generated by an AlgoUser (for example Algo Submitted, Limit Price changed, OrderQuantity change). ""Child"" rows reflect the actions of AlgoVendor, the institution responsible for algo execution. Those include child fills, order placements and rejects. At the minimum the child fills are provided "
Date,Date corresponding to TradeTime
TradeTime,TradeTime - Time (GMT) when the trade was filled
ArrivalTime,"For ""Parent” rows it is the time when algo user-event (order submitted, Quantity Changed, Limit Price changes) arrives. For ""Child” rows (for example Fill) ArrivalTime is the time when trade request was sent. It is GMT time"
Symbol,Currency pair. For example EURUSD.
Side,"Trade side. ""B” for buy and ""S” for sell."
Price,Execution Price for child fills.
TradeID,"Unique identifier for a trading event. Event can fill, order submission, reject or other event related to trading workflow"
ParentOrderID,ParentOrderID for each algo run. Globally unique to each submitting LP
OrderID,OrderID within specific ParentOrderID.
SubParentOrderID,"Identifies changes in algo execution regime as submitted by AlgoVendor to reflect the business logic. For example every time AlgoUrgency is changed, subParentOrderID can be changed. Then algo performance can be aggregated for different algo setting separately (grouping by ParentOrderID and subParentOrderID)"
TradeQuantity,Traded quantity expressed in TradeCurrency
OrderQuantity,"For ""Parent” rows it the amount of TradeCurrency that is actually required by the algo user.  For ""Child” rows it the amount requested by AlgoVendor from underlying LP"
TradeCurrency,Denomination Currency for TradeQuantity and OrderQuantity. For example EUR.
ExecVenue,"Execution Venue where the execution is taking place. For ""Parent"" rows it is channel name through which the algo order was submitted. For example: ""BankGUI"" or ""FXAll"" or ""Bloomberg"".  It is how the user connects to the underlying AlgoVendor. For ""Child"" order it is where the order was placed  or filled. For example ""Reuters"" or ""EBS"" if the order is place on those venues"
LP,"Executing LP - counterparty to the trade. For Parent rows it is the AlgoVendor, the institution responsible for specific ParentOrderID. For Child rows it is the actual LP (selected by AlgoVendor and can be AlgoVendor themselves) doing the child execution."
AlgoVendor,"Algo Vendor, Provider of the Algo. Unique for ParentOrderID. Same for Parent and Child rows."
LPstream,"Pricing Stream of Executing LP. For example ""No-Last-look”"
LiqPool,"Pool executing LP belongs to. Typically, liquidity pool is a group of LP aggregated according to some common logic by the end user."
QuoteTime,The time of the quote as labelled by executing LP. Quote time should generally be before the Arrival Time.
AlgoName,Name of the Algo.
OrderStatus,"For ""Child” rows it can be ""F"" for fills and ""R"" for Rejects. It can also be ""S"" for ""submitted” or ""C"" for ""cancelled” – in case AlgoVendor is willing to provide order placement information. For ""Parent” rows it is anything else which would make business sense for a client - for example AlgoStart, AlgoEnd, AlgoCancelled etc."
OrderType,For Child rows and fills it is normally Passive/Active/Mid or Limit/Market classification. The exact terminology is subject to AlgoVendor
OrderTTL,"Normally for ""Child” rows. FOK (Fill or Kill), AON, IOC, GTC, GTD"
LimitPrice,"For ""Parent” rows it the limit price as instructed by AlgoUser. Multiple ""parent” rows when Limit Price is changed. ArrivalTime indicates when the user submits the LimitPrice instructions (see ArrivalTime description). For ""Child” rows it is the whatever is the LimitPrice submitted by AlgoVendor while trading on an ECN"
Account,Name of the underlying client this ParentOrderID executed on behalf of
SubAccount,SubAccount associated with this ParentOrderID
TradeReason,"Any descriptive Trade Reason. Stop, Internal, External, RiskOverflow etc. User specific"
Trader,The name of  a trader associated with this ParentOrderID
AlgoUrgency,"AlgoUrgency. Provider defined parameters. For example: ""Medium"", ""High"" or ""Low"""
AlgoStrategy,"Additional Name for the AlgoName. Name of the strategy.  For example AlgoName can be ""TWAP"" and Strategy is ""Passive"""
ExchTradeID,"Exchange trade id  if execution is on one of the ECNs. Effectively it is an ID that ""ExecVenue"" would understand"
AlgoParams,"JSON file with any additional information about algo performance which cannot be described by any combination AlgoName, AlgoStrategy and AlgoUrgency"
NetPrice,"Price received by the client after Algo execution fees. Should be above ""Price"" for buy trades and below ""Price ""for sell trades."
ExecLoc,"Possible values include London,NewYork,Paris,Tokyo,Singapore. Geographical location where execution is taking place. Applied to location of the matching engine (can do LD4) or bank trading desk "
PrincipalMid,Fair mid-price for Symbol according Algo Vendor. It is provided by AlgoVendor and is understood as mid-price they would use to calculate algo performance
RiskTransferPrice,Fair risk transfer price according to AlgoVendor. It is provided by AlgoVendor and is understood as risk transfer price they would use to calculate algo performance.
ValueDate,Value date  for the trade
Product,"FXSPOT, FXNDF, FXFORWARD, FXSWAP"
SpotRate,"Agreed SpotRate for FXNDF, FXFORWARD,FXSWAP"
SideOriginal,Original Side submitted by AlgoVendor. This is mainly used for reconciliation purposes if AlgoVendor uses different notation internally.
PrimaryBid,For each fill or any event where you see PrimaryVenue bid correspond to the time of this event (TradeTime)
PrimaryAsk,For each fill or any other event where you see PrimaryVenue ask  correspond to the time of this event (TradeTime)
Platform,"Bloomberg, FXAll (Refinitiv). Should be same across Parent and Child orders "
PlatformOrderID,OrderID which is understood by the platform (see Platform Field)
TradeQuantityBase,TradeQuantity in the base currency of the Symbol
Midneg10s,Tradefeedr mid price 10s before the trade
Midneg5s,Tradefeedr mid price 5s before the trade
Midneg4s,Tradefeedr mid price 4s before the trade
Midneg3s,Tradefeedr mid price 3s before the trade
Midneg2s,Tradefeedr mid price 2s before the trade
Midneg1s,Tradefeedr mid price 1s before the trade
Midneg500ms,Tradefeedr mid price 500s before the trade
Midneg250ms,Tradefeedr mid price 250s before the trade
Midneg100ms,Tradefeedr mid price 100s before the trade
Mid0,Tradefeedr mid price at the time immediately preceding the TradeTime
Mid50ms,Tradefeedr mid price 50ms after the TradeTime
Mid100ms,Tradefeedr mid price 100ms after the TradeTime
Mid250ms,Tradefeedr mid price 250ms after the TradeTime
Mid500ms,Tradefeedr mid price 500ms after the TradeTime
Mid1s,Tradefeedr mid price 1s after the TradeTime
Mid2s,Tradefeedr mid price 2s after the TradeTime
Mid3s,Tradefeedr mid price 3s after the TradeTime
Mid4s,Tradefeedr mid price 4s after the TradeTime
Mid5s,Tradefeedr mid price 5s after the TradeTime
Mid10s,Tradefeedr mid price 10s after the TradeTime
Mid15s,Tradefeedr mid price 15s after the TradeTime
Mid20s,Tradefeedr mid price 20s after the TradeTime
Mid30s,Tradefeedr mid price 30s after the TradeTime
Mid45s,Tradefeedr mid price 45s after the TradeTime
Mid1m,Tradefeedr mid price 1m after the TradeTime
Mid2m,Tradefeedr mid price 2m after the TradeTime
Mid3m,Tradefeedr mid price 3m after the TradeTime
Mid4m,Tradefeedr mid price 4m after the TradeTime
Mid5m,Tradefeedr mid price 5m after the TradeTime
Mid10m,Tradefeedr mid price 10m after the TradeTime
DecayPMneg10s,Change in Tradefeedr mid price in $/m 10s  before the TradeTime
DecayPMneg5s,Change in Tradefeedr mid price in $/m 5s  before the TradeTime
DecayPMneg4s,Change in Tradefeedr mid price in $/m 4s  before the TradeTime
DecayPMneg3s,Change in Tradefeedr mid price in $/m 3s  before the TradeTime
DecayPMneg2s,Change in Tradefeedr mid price in $/m 2s  before the TradeTime
DecayPMneg1s,Change in Tradefeedr mid price in $/m1s  before the TradeTime
DecayPMneg500ms,Change in Tradefeedr mid price in $/m 500ms  before the TradeTime
DecayPMneg250ms,Change in Tradefeedr mid price in $/m 250ms  before the TradeTime
DecayPMneg100ms,Change in Tradefeedr mid price in $/m 100ms  before the TradeTime
DecayPM0,Always zero
DecayPM50ms,Change in Tradefeedr mid price in $/m 50ms  after the TradeTime
DecayPM100ms,Change in Tradefeedr mid price in $/m 100ms  after the TradeTime
DecayPM250ms,Change in Tradefeedr mid price in $/m 250ms  after the TradeTime
DecayPM500ms,Change in Tradefeedr mid price in $/m 500ms  after the TradeTime
DecayPM1s,Change in Tradefeedr mid price in $/m 1s  after the TradeTime
DecayPM2s,Change in Tradefeedr mid price in $/m 2s  after the TradeTime
DecayPM3s,Change in Tradefeedr mid price in $/m 3s  after the TradeTime
DecayPM4s,Change in Tradefeedr mid price in $/m 4s  after the TradeTime
DecayPM5s,Change in Tradefeedr mid price in $/m 5s  after the TradeTime
DecayPM10s,Change in Tradefeedr mid price in $/m 10s  after the TradeTime
DecayPM15s,Change in Tradefeedr mid price in $/m 15s  after the TradeTime
DecayPM20s,Change in Tradefeedr mid price in $/m 20s  after the TradeTime
DecayPM30s,Change in Tradefeedr mid price in $/m 30s  after the TradeTime
DecayPM45s,Change in Tradefeedr mid price in $/m 45s  after the TradeTime
DecayPM1m,Change in Tradefeedr mid price in $/m 1m  after the TradeTime
DecayPM2m,Change in Tradefeedr mid price in $/m 2m  after the TradeTime
DecayPM3m,Change in Tradefeedr mid price in $/m 3m  after the TradeTime
DecayPM4m,Change in Tradefeedr mid price in $/m 4m  after the TradeTime
DecayPM5m,Change in Tradefeedr mid price in $/m 5m  after the TradeTime
DecayPM10m,Change in Tradefeedr mid price in $/m 10m  after the TradeTime
TradeQuantityUSD,USD Equivalent of TradeQuantity
SpreadPnL,Spread Paid in Child Order in USD
SpreadPnLPM,Spread Paid in Child Order in $/million traded
OrderQuantityUSD,USD Equivalent of OrderQuantity
ArrivalPrice,Tradefeedr mid-price at the time immediately preceding Arrival Time
LatencyMillis,TradeTime minus ArrivalTime expressed in milliseconds
OrderExecutionScore,"Individual child order Execution Score - percentile rank of order execution Price againt mid-price distribution during algo execution.  For example, buy at the low of range would get a rank of 100 and buy at the high the price range would get a rank of 0. Reverse for sell order."
OrderReversalScore,Individual child order ReversalScore. It is rank-percentile of order execution Prices against mid-price distribution post algo execution. 
TwapExecution,Twap for the time algo was active in the market
TwapReversal,Twap for the reversal time algo post algo execution (half of execution time)
EventTime,EventTime is equal to TradeTime for Child rows and ArrivalTime for Parent rows.  EventTime is used to display/arrange all child and parent events in chronological order from the algo user perspective - when fills are done (child rows) and when new user instructions are submitted (parent rows).
```